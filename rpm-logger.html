<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPM Logger</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #2c3e50; --secondary: #3498db; --light: #ecf0f1; --border: #bdc3c7; --danger: #e74c3c; --success: #27ae60; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--light); color: var(--primary); }
        .app-container { max-width: 600px; margin: 0 auto; background: white; min-height: 100vh; }
        .header { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 18px; text-align: center; }
        .header h1 { font-size: 1.5rem; margin-bottom: 5px; }
        .content { padding: 16px; padding-bottom: 20px; }
        .card { background: white; border-radius: 8px; padding: 14px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid var(--secondary); }
        .card h2 { font-size: 1.1rem; margin-bottom: 12px; color: var(--primary); }
        .card p { font-size: 12px; margin-bottom: 8px; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 4px; font-size: 13px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; font-size: 13px; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--secondary); }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; margin-top: 8px; background: var(--secondary); color: white; }
        .btn:hover { background: #2980b9; }
        .btn-small { flex: 1; padding: 6px; font-size: 11px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-delete { background: var(--danger); color: white; }
        .btn-export { background: var(--success); color: white; }
        .status-message { margin-top: 10px; font-size: 12px; padding: 8px; border-radius: 4px; }
        .status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .entry-item { background: #f8f9fa; border: 1px solid var(--border); border-radius: 6px; padding: 12px; margin-bottom: 10px; }
        .entry-item h4 { font-size: 13px; font-weight: 700; margin-bottom: 6px; }
        .entry-details { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; margin-bottom: 8px; }
        .entry-detail { background: white; padding: 6px; border-radius: 4px; }
        .entry-detail-label { font-weight: 600; color: #7f8c8d; font-size: 10px; text-transform: uppercase; }
        .entry-detail-value { font-weight: 700; color: var(--secondary); margin-top: 2px; }
        .entry-actions { display: flex; gap: 6px; margin-top: 8px; }
        .button-group { display: flex; gap: 8px; margin-top: 8px; }
        .button-group button { flex: 1; }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>Drill Settings Logger</h1>
        </div>
        <div class="content">
            
            <!-- Drill Settings Logger -->
            <div class="card">
                <h2>‚öôÔ∏è Log Drilling Settings</h2>
                <p>Save your successful drilling parameters</p>

                <div class="form-group">
                    <label>Drill Model</label>
                    <select id="drill">
                        <optgroup label="Jumbos (DD Series)">
                            <option value="DD322">DD322</option>
                            <option value="DD422">DD422</option>
                        </optgroup>
                        <optgroup label="Long Hole (DL Series)">
                            <option value="DL422">DL422</option>
                            <option value="DL432">DL432</option>
                        </optgroup>
                        <optgroup label="Bolters (DS Series)">
                            <option value="DS412">DS412</option>
                        </optgroup>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div class="form-group">
                        <label>Bit (mm)</label>
                        <input type="number" id="bit" placeholder="45">
                    </div>
                    <div class="form-group">
                        <label>RPM</label>
                        <input type="number" id="rpm" placeholder="120">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div class="form-group">
                        <label>Pressure (bar)</label>
                        <input type="number" id="pressure" placeholder="150">
                    </div>
                    <div class="form-group">
                        <label>Rock Type</label>
                        <select id="rock">
                            <option value="Soft">Soft</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="Hard">Hard</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div class="form-group">
                        <label>Avg Rotation Pressure (bar)</label>
                        <input type="number" id="avgRotationPressure" placeholder="50" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Avg Penetration Rate (m/min)</label>
                        <input type="number" id="avgPenetrationRate" placeholder="2.5" step="0.1">
                    </div>
                </div>

                <div class="form-group">
                    <label>Location (Province)</label>
                    <select id="location">
                        <option value="">Select Province</option>
                        <option value="Alberta">Alberta</option>
                        <option value="British Columbia">British Columbia</option>
                        <option value="Manitoba">Manitoba</option>
                        <option value="New Brunswick">New Brunswick</option>
                        <option value="Newfoundland and Labrador">Newfoundland and Labrador</option>
                        <option value="Northwest Territories">Northwest Territories</option>
                        <option value="Nova Scotia">Nova Scotia</option>
                        <option value="Nunavut">Nunavut</option>
                        <option value="Ontario">Ontario</option>
                        <option value="Prince Edward Island">Prince Edward Island</option>
                        <option value="Quebec">Quebec</option>
                        <option value="Saskatchewan">Saskatchewan</option>
                        <option value="Yukon">Yukon</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="notes" placeholder="Drilling observations..." rows="2"></textarea>
                </div>

                <button class="btn" onclick="saveDrillEntry()">üíæ Save Entry</button>
                <div id="saveStatus"></div>
            </div>

            <!-- Saved Entries -->
            <div class="card">
                <h2>üìö Your Saved Entries</h2>
                <div id="logContainer"><p style="font-size: 12px; color: #7f8c8d; text-align: center;">No entries yet</p></div>
                <div class="button-group">
                    <button class="btn btn-export" onclick="downloadAsCSV()">üì• Download as CSV</button>
                    <button class="btn btn-export" onclick="downloadAsJSON()">üì• Download as JSON</button>
                </div>
            </div>

        </div>
    </div>

    <script>
        const KEY = 'drilling_log';
        
        function saveDrillEntry() {
            const entry = {
                id: Date.now(),
                drill: document.getElementById('drill').value,
                bit: document.getElementById('bit').value,
                rpm: document.getElementById('rpm').value,
                pressure: document.getElementById('pressure').value,
                rock: document.getElementById('rock').value,
                avgRotationPressure: document.getElementById('avgRotationPressure').value,
                avgPenetrationRate: document.getElementById('avgPenetrationRate').value,
                location: document.getElementById('location').value,
                notes: document.getElementById('notes').value,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString()
            };
            
            const statusDiv = document.getElementById('saveStatus');
            
            try {
                statusDiv.className = 'status-message status-success';
                statusDiv.innerHTML = '‚úÖ Entry saved locally';
                
                // Save to user's local storage
                let entries = JSON.parse(localStorage.getItem(KEY)) || [];
                entries.unshift(entry);
                localStorage.setItem(KEY, JSON.stringify(entries));

                        // Silently upload to server (no user notification if it fails)
        try {
          const filename = `drill-log-${entry.id}.json`;
          fetch('/api/upload', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              filename: filename,
              fileContent: JSON.stringify(entry, null, 2)
            })
          }).catch(() => {
            // Silently fail - entry is already saved locally
          });
        } catch (e) {
          // Silently fail - entry is already saved locally
        }
                
                // Clear form
                document.getElementById('drill').value = 'DD322';
                document.getElementById('bit').value = '';
                document.getElementById('rpm').value = '';
                document.getElementById('pressure').value = '';
                document.getElementById('rock').value = 'Medium';
                document.getElementById('avgRotationPressure').value = '';
                document.getElementById('avgPenetrationRate').value = '';
                document.getElementById('location').value = '';
                document.getElementById('notes').value = '';
                
                // Refresh display
                displayEntries();
                
            } catch (error) {
                statusDiv.className = 'status-message status-error';
                statusDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        function deleteEntry(id) {
            if (confirm('Delete this entry?')) {
                let entries = JSON.parse(localStorage.getItem(KEY)) || [];
                entries = entries.filter(e => e.id !== id);
                localStorage.setItem(KEY, JSON.stringify(entries));
                displayEntries();
            }
        }
        
        function displayEntries() {
            const entries = JSON.parse(localStorage.getItem(KEY)) || [];
            const html = entries.map(e => `
                <div class="entry-item">
                    <h4>${e.drill} - ${e.date} ${e.time}</h4>
                    <div class="entry-details">
                        <div class="entry-detail">
                            <div class="entry-detail-label">Bit</div>
                            <div class="entry-detail-value">${e.bit}mm</div>
                        </div>
                        <div class="entry-detail">
                            <div class="entry-detail-label">RPM</div>
                            <div class="entry-detail-value">${e.rpm}</div>
                        </div>
                        <div class="entry-detail">
                            <div class="entry-detail-label">Pressure</div>
                            <div class="entry-detail-value">${e.pressure}bar</div>
                        </div>
                        <div class="entry-detail">
                            <div class="entry-detail-label">Rock</div>
                            <div class="entry-detail-value">${e.rock}</div>
                        </div>
                    </div>
                    <div class="entry-details">
                        <div class="entry-detail">
                            <div class="entry-detail-label">Avg Rotation</div>
                            <div class="entry-detail-value">${e.avgRotationPressure}bar</div>
                        </div>
                        <div class="entry-detail">
                            <div class="entry-detail-label">Avg Penetration</div>
                            <div class="entry-detail-value">${e.avgPenetrationRate}m/min</div>
                        </div>
                    </div>
                    ${e.location ? `<p style="font-size: 11px;"><strong>Location:</strong> ${e.location}</p>` : ''}
                    ${e.notes ? `<p style="font-size: 11px;"><strong>Notes:</strong> ${e.notes}</p>` : ''}
                    <div class="entry-actions">
                        <button class="btn-small btn-delete" onclick="deleteEntry(${e.id})">Delete</button>
                    </div>
                </div>
            `).join('') || '<p style="font-size: 12px; color: #7f8c8d; text-align: center;">No entries yet</p>';
            
            document.getElementById('logContainer').innerHTML = html;
        }
        
        function downloadAsCSV() {
            const entries = JSON.parse(localStorage.getItem(KEY)) || [];
            if (entries.length === 0) {
                alert('No entries to export');
                return;
            }
            
            const headers = ['Date', 'Time', 'Drill Model', 'Bit (mm)', 'RPM', 'Pressure (bar)', 'Rock Type', 'Avg Rotation (bar)', 'Avg Penetration (m/min)', 'Location', 'Notes'];
            const rows = entries.map(e => [
                e.date,
                e.time,
                e.drill,
                e.bit,
                e.rpm,
                e.pressure,
                e.rock,
                e.avgRotationPressure,
                e.avgPenetrationRate,
                e.location,
                e.notes
            ]);
            
            const csv = [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `drill-logs-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        
        function downloadAsJSON() {
            const entries = JSON.parse(localStorage.getItem(KEY)) || [];
            if (entries.length === 0) {
                alert('No entries to export');
                return;
            }
            
            const json = JSON.stringify(entries, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `drill-logs-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        
        // Load entries on page load
        displayEntries();
    </script>
</body>
</html>
